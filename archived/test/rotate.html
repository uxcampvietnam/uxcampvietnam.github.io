<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Device Tilt Demo — Góc nghiêng điện thoại</title>
  <style>
    :root{--w:320px}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:20px;display:flex;flex-direction:column;gap:16px;align-items:center}
    .panel{max-width:720px;width:100%;border:1px solid #ddd;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    h1{font-size:18px;margin:0 0 8px}
    .readouts{display:flex;gap:12px;flex-wrap:wrap}
    .badge{background:#f5f7fb;padding:10px;border-radius:8px;min-width:110px;text-align:center}
    .cube-wrap{width:var(--w);height:var(--w);perspective:800px;margin:10px auto}
    .cube{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 0.08s linear}
    .face{position:absolute;inset:0;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
    .front{background:#1f77b4;transform:translateZ(calc(var(--w)/2))}
    .back{background:#ff7f0e;transform:rotateY(180deg) translateZ(calc(var(--w)/2))}
    .right{background:#2ca02c;transform:rotateY(90deg) translateZ(calc(var(--w)/2))}
    .left{background:#d62728;transform:rotateY(-90deg) translateZ(calc(var(--w)/2))}
    .top{background:#9467bd;transform:rotateX(90deg) translateZ(calc(var(--w)/2))}
    .bottom{background:#8c564b;transform:rotateX(-90deg) translateZ(calc(var(--w)/2))}
    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    label{font-size:13px}
    input[type=range]{width:200px}
    button{padding:8px 12px;border-radius:8px;border:1px solid #ccc;background:white}
    small{color:#666}
  </style>
</head>
<body>
  <div class="panel">
    <h1>Demo đọc góc nghiêng điện thoại (DeviceOrientation / DeviceMotion)</h1>
    <p><small>Mở trang này trên điện thoại (hoặc trên desktop dùng các slider) — nếu dùng iOS, hãy chạm nút <strong>Allow Motion</strong> khi được yêu cầu.</small></p>

    <div class="readouts">
      <div class="badge">alpha: <span id="alpha">—</span>°</div>
      <div class="badge">beta: <span id="beta">—</span>°</div>
      <div class="badge">gamma: <span id="gamma">—</span>°</div>
    </div>

    <div class="cube-wrap" style="    transform: scale(0.5);">
      <div id="cube" class="cube">
        <div class="face front">FRONT</div>
        <div class="face back">BACK</div>
        <div class="face right">RIGHT</div>
        <div class="face left">LEFT</div>
        <div class="face top">TOP</div>
        <div class="face bottom">BOTTOM</div>
      </div>
    </div>

    <div style="text-align:center;margin-top:6px">
      <button id="btnPermission">Allow Motion (iOS)</button>
      <button id="btnClear">Reset</button>
    </div>

    <hr>

    <div class="controls">
      <div>
        <label>alpha (z) <br><input type="range" id="sAlpha" min="-180" max="180" value="0"></label>
      </div>
      <div>
        <label>beta (x) <br><input type="range" id="sBeta" min="-180" max="180" value="0"></label>
      </div>
      <div>
        <label>gamma (y) <br><input type="range" id="sGamma" min="-90" max="90" value="0"></label>
      </div>
    </div>

    <p style="text-align:center"><small>Console sẽ log dữ liệu khi có sự kiện deviceorientation. Nếu bạn mở trên desktop, dùng slider để mô phỏng.</small></p>
  </div>

  <script>
    const alphaEl = document.getElementById('alpha');
    const betaEl = document.getElementById('beta');
    const gammaEl = document.getElementById('gamma');
    const cube = document.getElementById('cube');
    const sAlpha = document.getElementById('sAlpha');
    const sBeta = document.getElementById('sBeta');
    const sGamma = document.getElementById('sGamma');
    const btnPermission = document.getElementById('btnPermission');
    const btnClear = document.getElementById('btnClear');

    function handleOrientation(e) {
      const a = e.alpha ?? 0; // z
      const b = e.beta  ?? 0; // x (front-back)
      const g = e.gamma ?? 0; // y (left-right)

      alphaEl.textContent = a.toFixed(1);
      betaEl.textContent = b.toFixed(1);
      gammaEl.textContent = g.toFixed(1);

      // apply to cube: rotateX by beta, rotateY by alpha, rotateZ by gamma
      cube.style.transform = `rotateX(${b}deg) rotateY(${a}deg) rotateZ(${g}deg)`;

      console.log('orientation', {alpha: a, beta: b, gamma: g});
    }

    // Listen to real device orientation when available
    if (window.DeviceOrientationEvent) {
      // Some browsers (iOS) require permission
      window.addEventListener('deviceorientation', handleOrientation);
    } else {
      console.warn('DeviceOrientationEvent not supported on this device/browser');
    }

    // iOS 13+ require explicit permission via a user gesture
    btnPermission.addEventListener('click', async () => {
      if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
        try {
          const res = await DeviceMotionEvent.requestPermission();
          if (res === 'granted') {
            window.addEventListener('deviceorientation', handleOrientation);
            alert('Permission granted — move your device to see values update.');
          } else {
            alert('Permission denied.');
          }
        } catch (err) {
          alert('Permission API error: ' + err);
        }
      } else {
        alert('Không cần permission trên trình duyệt này — thử nghiêng thiết bị!');
      }
    });

    // Reset
    btnClear.addEventListener('click', () => {
      sAlpha.value = 0; sBeta.value = 0; sGamma.value = 0;
      alphaEl.textContent = '—'; betaEl.textContent = '—'; gammaEl.textContent = '—';
      cube.style.transform = '';
    });

    // Desktop sliders to simulate device movement
    function applySliders() {
      const a = Number(sAlpha.value);
      const b = Number(sBeta.value);
      const g = Number(sGamma.value);
      alphaEl.textContent = a.toFixed(1);
      betaEl.textContent = b.toFixed(1);
      gammaEl.textContent = g.toFixed(1);
      cube.style.transform = `rotateX(${b}deg) rotateY(${a}deg) rotateZ(${g}deg)`;
      console.log('simulated', {alpha: a, beta: b, gamma: g});
    }
    sAlpha.addEventListener('input', applySliders);
    sBeta.addEventListener('input', applySliders);
    sGamma.addEventListener('input', applySliders);

    // Helpful note: show when orientation events are firing
    let lastEvent = Date.now();
    setInterval(() => {
      const now = Date.now();
      // nothing fancy — you can expand this
    }, 1000);
  </script>
</body>
</html>
